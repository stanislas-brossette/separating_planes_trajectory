#include <iostream>

#include <boost/test/unit_test.hpp>

#include <Eigen/Core>

#include <feet-trajectory/utils/Jerk3DIntegrator.hh>

using namespace feettrajectory;

BOOST_AUTO_TEST_CASE(testJerk3DIntegrator)
{
  Jerk3DIntegrator integ(0.1, 4);
  Eigen::MatrixXd Ux, Uu, SelPos, SelVel, SelAcc;
  Ux.resize(36, 9);
  Ux << 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
      0, 0, 0, 0.1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0.1, 0, 0, 1, 0, 0, 0, 0, 0, 0,
      0.1, 0, 0, 1, 0, 0, 0, 0.005, 0, 0, 0.1, 0, 0, 1, 0, 0, 0, 0.005, 0, 0,
      0.1, 0, 0, 1, 0, 0, 0, 0.005, 0, 0, 0.1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0.2, 0, 0, 1, 0,
      0, 0, 0, 0, 0, 0.2, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0.2, 0, 0, 1, 0, 0, 0,
      0.02, 0, 0, 0.2, 0, 0, 1, 0, 0, 0, 0.02, 0, 0, 0.2, 0, 0, 1, 0, 0, 0,
      0.02, 0, 0, 0.2, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0.3, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0.3, 0,
      0, 1, 0, 0, 0, 0, 0, 0, 0.3, 0, 0, 1, 0, 0, 0, 0.045, 0, 0, 0.3, 0, 0, 1,
      0, 0, 0, 0.045, 0, 0, 0.3, 0, 0, 1, 0, 0, 0, 0.045, 0, 0, 0.3, 0, 0, 1, 1,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
      0, 0.4, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0.4, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0.4, 0,
      0, 1, 0, 0, 0, 0.08, 0, 0, 0.4, 0, 0, 1, 0, 0, 0, 0.08, 0, 0, 0.4, 0, 0,
      1, 0, 0, 0, 0.08, 0, 0, 0.4, 0, 0, 1;
  Uu.resize(36, 12);
  Uu << 0.000166667, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000166667, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000166667, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.005,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.005, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0.005, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.1, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0.000166667, 0, 0, 0.000166667, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.000166667, 0, 0, 0.000166667, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000166667, 0,
      0, 0.000166667, 0, 0, 0, 0, 0, 0, 0.00501667, 0, 0, 0.005, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0.00501667, 0, 0, 0.005, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.00501667, 0, 0, 0.005, 0, 0, 0, 0, 0, 0, 0.100501, 0, 0, 0.1, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0.100501, 0, 0, 0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.100501, 0, 0, 0.1, 0, 0, 0, 0, 0, 0, 0.000166667, 0, 0, 0.000166667, 0,
      0, 0.000166667, 0, 0, 0, 0, 0, 0, 0.000166667, 0, 0, 0.000166667, 0, 0,
      0.000166667, 0, 0, 0, 0, 0, 0, 0.000166667, 0, 0, 0.000166667, 0, 0,
      0.000166667, 0, 0, 0, 0.00503333, 0, 0, 0.00501667, 0, 0, 0.005, 0, 0, 0,
      0, 0, 0, 0.00503333, 0, 0, 0.00501667, 0, 0, 0.005, 0, 0, 0, 0, 0, 0,
      0.00503333, 0, 0, 0.00501667, 0, 0, 0.005, 0, 0, 0, 0.101003, 0, 0,
      0.100501, 0, 0, 0.1, 0, 0, 0, 0, 0, 0, 0.101003, 0, 0, 0.100501, 0, 0,
      0.1, 0, 0, 0, 0, 0, 0, 0.101003, 0, 0, 0.100501, 0, 0, 0.1, 0, 0, 0,
      0.000166667, 0, 0, 0.000166667, 0, 0, 0.000166667, 0, 0, 0.000166667, 0,
      0, 0, 0.000166667, 0, 0, 0.000166667, 0, 0, 0.000166667, 0, 0,
      0.000166667, 0, 0, 0, 0.000166667, 0, 0, 0.000166667, 0, 0, 0.000166667,
      0, 0, 0.000166667, 0.00505, 0, 0, 0.00503333, 0, 0, 0.00501667, 0, 0,
      0.005, 0, 0, 0, 0.00505, 0, 0, 0.00503333, 0, 0, 0.00501667, 0, 0, 0.005,
      0, 0, 0, 0.00505, 0, 0, 0.00503333, 0, 0, 0.00501667, 0, 0, 0.005,
      0.101508, 0, 0, 0.101003, 0, 0, 0.100501, 0, 0, 0.1, 0, 0, 0, 0.101508, 0,
      0, 0.101003, 0, 0, 0.100501, 0, 0, 0.1, 0, 0, 0, 0.101508, 0, 0, 0.101003,
      0, 0, 0.100501, 0, 0, 0.1;
  SelPos.resize(12, 36);
  SelPos << 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 1, 0, 0, 0, 0, 0, 0;
  SelVel.resize(12, 36);
  SelVel << 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 1, 0, 0, 0;
  SelAcc.resize(12, 36);
  SelAcc << 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 1;

  BOOST_CHECK(Ux.isApprox(integ.Ux()));
  BOOST_CHECK(Uu.isApprox(integ.Uu(), 1e-3));
  BOOST_CHECK(SelPos.isApprox(integ.SelPos()));
  BOOST_CHECK(SelVel.isApprox(integ.SelVel()));
  BOOST_CHECK(SelAcc.isApprox(integ.SelAcc()));
}
